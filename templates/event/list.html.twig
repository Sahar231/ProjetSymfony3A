{% extends 'base.html.twig' %}

{% block title %}{{ club.name }} - Events{% endblock %}

{% block body %}
<main>
<section class="bg-dark align-items-center d-flex" style="background: url({{ asset('assets/images/pattern/04.png') }}) no-repeat center center; background-size: cover;">
	<div class="container">
		<div class="row">
			<div class="col-12">
				<h1 class="text-white">{{ club.name }} - Events</h1>
				<nav aria-label="breadcrumb">
					<ol class="breadcrumb breadcrumb-dark breadcrumb-dots mb-0">
						<li class="breadcrumb-item"><a href="{{ path("app_home") }}">Home</a></li>
						<li class="breadcrumb-item"><a href="{{ path("club_list") }}">Clubs</a></li>
						<li class="breadcrumb-item"><a href="{{ path("club_detail", {"id": club.id}) }}">{{ club.name }}</a></li>
						<li class="breadcrumb-item active">Events</li>
					</ol>
				</nav>
			</div>
		</div>
	</div>
</section>

<section class="py-5">
	<div class="container">
		<!-- Create Event Button -->
		{% if app.user and app.user.id == club.creator.id %}
			<div class="row mb-4">
				<div class="col-12">
					<a href="{{ path('event_create', {'clubId': club.id}) }}" class="btn btn-success btn-lg">
						<i class="fas fa-calendar-plus me-2"></i>Create New Event
					</a>
				</div>
			</div>
		{% endif %}

		<!-- Search and Filter -->
		<div class="row mb-4">
			<div class="col-12">
				<div class="card bg-light p-4">
					<h5 class="mb-3"><i class="fas fa-filter me-2"></i>Filter Events</h5>
					<form method="GET" class="row g-2 align-items-end">
						<div class="col-md-5">
							<label for="search" class="form-label">Search Event</label>
							<input type="text" class="form-control" id="search" name="search" placeholder="Title or description..." value="{{ request.query.get('search') }}">
						</div>

						<div class="col-md-4">
							<label for="sortBy" class="form-label">Sort by</label>
							<select class="form-select" id="sortBy" name="sortBy">
								<option value="newest" {% if request.query.get('sortBy') == 'newest' %}selected{% endif %}>Newest First</option>
								<option value="oldest" {% if request.query.get('sortBy') == 'oldest' %}selected{% endif %}>Oldest First</option>
								<option value="date" {% if request.query.get('sortBy') == 'date' %}selected{% endif %}>Event Date</option>
								<option value="a-z" {% if request.query.get('sortBy') == 'a-z' %}selected{% endif %}>A-Z</option>
							</select>
						</div>

						<div class="col-md-3">
							<button type="submit" class="btn btn-primary w-100">
								<i class="fas fa-search me-2"></i>Search
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<!-- Events List -->
		<div class="row g-4">
			{% if events|length > 0 %}
				{% for event in events %}
					<div class="col-lg-6">
						<div class="card h-100 shadow-sm hover-shadow-lg transition-all">
							<div class="card-body">
								<div class="mb-3">
									<h5 class="card-title">{{ event.title }}</h5>
									<small class="text-muted">
										<i class="fas fa-calendar me-1"></i>
										{{ event.eventDate|date('d/m/Y H:i') }}
									</small>
								</div>

								<p class="card-text text-muted">{{ event.description|slice(0, 100) }}{% if event.description|length > 100 %}...{% endif %}</p>

								<div class="mb-3">
									<small class="text-muted">
										<i class="fas fa-map-marker-alt me-1"></i>
										{{ event.location }}
									</small>
									<br>
									<small class="text-muted">
										<i class="fas fa-user me-1"></i>
										By {{ event.creator.firstName }} {{ event.creator.lastName }}
									</small>
								</div>

								<div class="d-flex gap-2">
									<a href="{{ path('event_detail', {'clubId': club.id, 'id': event.id}) }}" class="btn btn-outline-primary btn-sm">
										<i class="fas fa-eye me-1"></i>View Details
									</a>

									{% if app.user and app.user.id == event.creator.id %}
										<a href="{{ path('event_edit', {'clubId': club.id, 'id': event.id}) }}" class="btn btn-outline-warning btn-sm">
											<i class="fas fa-edit me-1"></i>Edit
										</a>
										<form method="POST" action="{{ path('event_delete', {'clubId': club.id, 'id': event.id}) }}" class="d-inline" onsubmit="return confirm('Delete this event?')">
											<button type="submit" class="btn btn-outline-danger btn-sm">
												<i class="fas fa-trash me-1"></i>Delete
											</button>
										</form>
									{% endif %}
								</div>
							</div>
						</div>
					</div>
				{% endfor %}
			{% else %}
				<div class="col-12">
					<div class="text-center py-5">
						<i class="fas fa-inbox text-muted" style="font-size: 3rem;"></i>
						<p class="text-muted mt-3">
							{% if request.query.has('search') or request.query.has('sortBy') %}
								No events match your search criteria
							{% else %}
								No events yet. 
								{% if app.user and app.user.id == club.creator.id %}
									<a href="{{ path('event_create', {'clubId': club.id}) }}">Create the first event!</a>
								{% endif %}
							{% endif %}
						</p>
					</div>
				</div>
			{% endif %}
		</div>

		<!-- Back Button -->
		<div class="row mt-4">
			<div class="col-12">
				<a href="{{ path('club_detail', {'id': club.id}) }}" class="btn btn-secondary">
					<i class="fas fa-arrow-left me-2"></i>Back to Club
				</a>
			</div>
		</div>
	</div>
</section>
</main>
{% endblock %}
