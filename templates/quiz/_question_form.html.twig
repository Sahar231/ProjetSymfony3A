<div class="question-item card border-secondary mb-3" data-question-index="{{ index }}">
    <div class="card-header bg-light d-flex justify-content-between align-items-center">
        <h6 class="mb-0">
            <i class="fas fa-question-circle"></i> Question {{ index + 1 }}
        </h6>
        <button type="button" class="btn btn-sm btn-outline-danger" data-delete-question>
            <i class="fas fa-trash"></i> Delete
        </button>
    </div>
    
    <div class="card-body">
        <div class="form-group mb-3">
            {{ form_label(form.question) }}
            {{ form_widget(form.question, { 'attr': { 'class': 'form-control', 'rows': '3', 'placeholder': 'Enter your question here...' } }) }}
            {{ form_errors(form.question) }}
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="form-group mb-3">
                    {{ form_label(form.correctAnswer) }}
                    {{ form_widget(form.correctAnswer, { 'attr': { 'class': 'form-control', 'placeholder': 'e.g., A or The correct answer' } }) }}
                    {{ form_errors(form.correctAnswer) }}
                </div>
            </div>
            <div class="col-md-6">
                <div class="form-group mb-3">
                    {{ form_label(form.score) }}
                    {{ form_widget(form.score, { 'attr': { 'class': 'form-control', 'type': 'number', 'step': '0.01', 'min': '0' } }) }}
                    {{ form_errors(form.score) }}
                </div>
            </div>
        </div>

        <div class="form-group mb-3">
            {{ form_label(form.type) }}
            {{ form_widget(form.type, { 'attr': { 'class': 'form-control' } }) }}
            {{ form_errors(form.type) }}
        </div>

        <div class="form-group">
            <label class="form-label">
                <i class="fas fa-chess"></i> Answer Choices
            </label>
            <div id="choices-container-{{ index }}" class="choices-list">
                {% for choice in form.choices %}
                    <div class="choice-item input-group mb-2">
                        {{ form_widget(choice, { 'attr': { 'class': 'form-control', 'placeholder': 'Enter choice...' } }) }}
                        <button type="button" class="btn btn-outline-danger" data-delete-choice>
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                {% endfor %}
            </div>
            <button type="button" class="btn btn-sm btn-outline-secondary mt-2" data-add-choice data-index="{{ index }}">
                <i class="fas fa-plus"></i> Add Choice
            </button>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const choicesContainer = document.getElementById('choices-container-{{ index }}');
    
    // Add choice functionality
    const addChoiceBtn = document.querySelector('[data-add-choice][data-index="{{ index }}"]');
    if (addChoiceBtn && choicesContainer) {
        addChoiceBtn.addEventListener('click', function(e) {
            e.preventDefault();
            const choiceIndex = choicesContainer.children.length;
            const choiceInput = document.createElement('div');
            choiceInput.className = 'choice-item input-group mb-2';
            choiceInput.innerHTML = `
                <input type="text" class="form-control" name="quiz[questions][{{ index }}][choices][${choiceIndex}]" placeholder="Enter choice...">
                <button type="button" class="btn btn-outline-danger" data-delete-choice>
                    <i class="fas fa-times"></i>
                </button>
            `;
            choicesContainer.appendChild(choiceInput);
            
            // Add delete handler to the new choice
            const deleteBtn = choiceInput.querySelector('[data-delete-choice]');
            deleteBtn.addEventListener('click', function(e) {
                e.preventDefault();
                choiceInput.remove();
            });
        });
    }

    // Delete choice functionality
    const deleteChoiceBtns = choicesContainer.querySelectorAll('[data-delete-choice]');
    deleteChoiceBtns.forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            this.closest('.choice-item').remove();
        });
    });

    // Delete question functionality
    const deleteQuestionBtn = document.querySelector('[data-question-index="{{ index }}"] [data-delete-question]');
    if (deleteQuestionBtn) {
        deleteQuestionBtn.addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelector('[data-question-index="{{ index }}"]').remove();
        });
    }
});
</script>
