{% extends 'base.html.twig' %}

{% block title %}{{ quiz.title }}{% endblock %}

{% block body %}
<div class="container mt-5">
    <div class="row">
        <div class="col-md-12">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <div class="d-flex justify-content-between align-items-center">
                        <h1 class="mb-0">{{ quiz.title }}</h1>
                        <div>
                            {% if is_granted('ROLE_INSTRUCTOR') and app.user == quiz.creator %}
                                <a href="{{ path('quiz_edit', {id: quiz.id}) }}" class="btn btn-warning btn-sm">Edit</a>
                                <form method="POST" action="{{ path('quiz_delete', {id: quiz.id}) }}" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this quiz?');">
                                    <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ quiz.id) }}">
                                    <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                                </form>
                            {% endif %}
                            {% if is_granted('ROLE_ADMIN') and quiz.state == 'pending' %}
                                <form method="POST" action="{{ path('quiz_approve', {id: quiz.id}) }}" style="display:inline;">
                                    <button type="submit" class="btn btn-success btn-sm">Approve</button>
                                </form>
                                <form method="POST" action="{{ path('quiz_reject', {id: quiz.id}) }}" style="display:inline;">
                                    <button type="submit" class="btn btn-danger btn-sm">Reject</button>
                                </form>
                            {% endif %}
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="row mb-4">
                        <div class="col-md-3">
                            <strong>Level:</strong>
                            <span class="badge bg-info">{{ quiz.level }}</span>
                        </div>
                        <div class="col-md-3">
                            <strong>State:</strong>
                            {% if quiz.state == 'approved' %}
                                <span class="badge bg-success">{{ quiz.state }}</span>
                            {% elseif quiz.state == 'pending' %}
                                <span class="badge bg-warning">{{ quiz.state }}</span>
                            {% else %}
                                <span class="badge bg-danger">{{ quiz.state }}</span>
                            {% endif %}
                        </div>
                        <div class="col-md-3">
                            <strong>Created By:</strong> {{ quiz.creator.firstname }} {{ quiz.creator.lastname }}
                        </div>
                        <div class="col-md-3">
                            <strong>Created At:</strong> {{ quiz.createdAt | format_datetime }}
                        </div>
                    </div>

                    <hr>

                    <h3>Questions ({{ quiz.questions | length }})</h3>
                    
                    {% if quiz.questions | length == 0 %}
                        <div class="alert alert-info">No questions added yet</div>
                    {% else %}
                        <div class="row">
                            {% for question in quiz.questions %}
                                <div class="col-md-12 mb-4">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5>Question {{ loop.index }}: {{ question.question }}</h5>
                                        </div>
                                        <div class="card-body">
                                            <p><strong>Type:</strong> {{ question.type }}</p>
                                            <p><strong>Score:</strong> {{ question.score }}</p>
                                            <p><strong>Correct Answer:</strong> {{ question.correctAnswer }}</p>
                                            
                                            {% if question.choices %}
                                                <p><strong>Options:</strong></p>
                                                <ul>
                                                    {% for choice in question.choices %}
                                                        <li>{{ choice }}</li>
                                                    {% endfor %}
                                                </ul>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="mt-3">
                <a href="{{ path('quiz_index') }}" class="btn btn-secondary">Back to Quizzes</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}
